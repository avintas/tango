# Source Content Ingested - Table Schema

## Table Name

**`source_content_ingested`**

## Field Specifications

| Field Name             | Data Type   | Constraints                | Required | Default | Description                                                                                  |
| ---------------------- | ----------- | -------------------------- | -------- | ------- | -------------------------------------------------------------------------------------------- |
| `id`                   | BIGSERIAL   | PRIMARY KEY                | Yes      | Auto    | Unique identifier                                                                            |
| `content_text`         | TEXT        | NOT NULL                   | Yes      | -       | The source content text                                                                      |
| `word_count`           | INTEGER     | -                          | No       | NULL    | Number of words in content                                                                   |
| `char_count`           | INTEGER     | -                          | No       | NULL    | Number of characters in content                                                              |
| `theme`                | TEXT        | NOT NULL, CHECK constraint | Yes      | -       | Primary theme (AI-extracted, required, must be one of 5 standardized themes)                 |
| `tags`                 | TEXT[]      | -                          | No       | NULL    | Rich tag fabric array (AI-extracted)                                                         |
| `category`             | TEXT        | CHECK constraint           | No       | NULL    | Theme-specific category refinement (AI-detected, must be one of ~20 standardized categories) |
| `summary`              | TEXT        | -                          | No       | NULL    | AI-generated summary                                                                         |
| `title`                | TEXT        | -                          | No       | NULL    | AI-generated title                                                                           |
| `key_phrases`          | TEXT[]      | -                          | No       | NULL    | Key phrases array (AI-extracted)                                                             |
| `metadata`             | JSONB       | -                          | No       | NULL    | Additional AI-generated metadata (flexible)                                                  |
| `ingestion_process_id` | TEXT        | -                          | No       | NULL    | Link to process execution (for tracking)                                                     |
| `ingestion_status`     | TEXT        | NOT NULL, CHECK constraint | Yes      | 'draft' | Workflow status: 'draft', 'validated', 'enriched', 'complete'                                |
| `created_at`           | TIMESTAMPTZ | NOT NULL                   | Yes      | NOW()   | Record creation timestamp                                                                    |
| `updated_at`           | TIMESTAMPTZ | NOT NULL                   | Yes      | NOW()   | Record last update timestamp (auto-updated via trigger)                                      |

## Field Details

### Content Fields

- **`content_text`**: The actual source content that was ingested
- **`word_count`**: Calculated word count (for statistics)
- **`char_count`**: Calculated character count (for statistics)

### AI-Extracted Metadata Fields

- **`theme`**: Primary theme/topic (required - must be one of 5 standardized themes: "Players", "Teams & Organizations", "Venues & Locations", "Awards & Honors", "Leadership & Staff")
- **`tags`**: Array of relevant tags/keywords (rich fabric for matching)
- **`category`**: Theme-specific category refinement (standardized list of ~20 categories organized by theme)
- **`summary`**: Brief summary generated by AI
- **`title`**: Title generated by AI (if not provided manually)
- **`key_phrases`**: Array of important phrases/concepts extracted by AI
- **`metadata`**: JSONB field for flexible additional metadata

### Workflow Tracking Fields

- **`ingestion_process_id`**: Links to the process execution (for debugging/tracking)
- **`ingestion_status`**: Tracks where content is in the workflow:
  - `'draft'` - Initial state
  - `'validated'` - Passed validation
  - `'enriched'` - AI enrichment complete
  - `'complete'` - Fully processed and ready

### Timestamp Fields

- **`created_at`**: When the record was created
- **`updated_at`**: Automatically updated via trigger on any UPDATE

## Indexes

| Index Name                            | Fields             | Type          | Purpose                         |
| ------------------------------------- | ------------------ | ------------- | ------------------------------- |
| `idx_source_content_theme`            | `theme`            | B-tree        | Fast theme filtering            |
| `idx_source_content_category`         | `category`         | B-tree        | Fast category filtering         |
| `idx_source_content_ingestion_status` | `ingestion_status` | B-tree        | Filter by workflow status       |
| `idx_source_content_tags`             | `tags`             | GIN           | Array search (contains queries) |
| `idx_source_content_key_phrases`      | `key_phrases`      | GIN           | Array search (contains queries) |
| `idx_source_content_metadata`         | `metadata`         | GIN           | JSONB search                    |
| `idx_source_content_created_at`       | `created_at`       | B-tree (DESC) | Recent content queries          |
| `idx_source_content_title`            | `title`            | B-tree        | Title search                    |

## Constraints

- **PRIMARY KEY**: `id`
- **NOT NULL**: `content_text`, `theme`, `ingestion_status`, `created_at`, `updated_at`
- **CHECK**: `theme` must be exactly one of: 'Players', 'Teams & Organizations', 'Venues & Locations', 'Awards & Honors', 'Leadership & Staff'
- **CHECK**: `category` must be one of the standardized categories (if provided): 'Player Spotlight', 'Sharpshooters', 'Net Minders', 'Icons', 'Captains', 'Hockey is Family', 'Stanley Cup Playoffs', 'NHL Draft', 'Free Agency', 'Game Day', 'Hockey Nations', 'All-Star Game', 'Heritage Classic', 'Stadium Series', 'Global Series', 'NHL Awards', 'Milestones', 'Coaching', 'Management', 'Front Office'
- **CHECK**: `ingestion_status` must be one of: 'draft', 'validated', 'enriched', 'complete'
- **DEFAULT**: `ingestion_status` = 'draft', `created_at` = NOW(), `updated_at` = NOW()

## Triggers

- **`on_source_content_update`**: Automatically updates `updated_at` timestamp on any UPDATE
