# Wisdom Content Structure Update

## Overview

Updated the `content` table to support structured wisdom content with separate fields for title, philosophical musings, and penalty box commentary.

## Database Changes

### New Columns

Added to the `content` table:

- **`content_title`** (TEXT, nullable)
  - 3-4 word title generated by Gemini
  - Used for ALL content types
  - Example: "Patience Under Pressure"

- **`musings`** (TEXT, nullable)
  - The philosophical quote or thought
  - **Wisdom only**
  - Example: "The best defense isn't just keeping the puck out of your zone, it's building a better zone for everyone."

- **`from_the_box`** (TEXT, nullable)
  - The penalty box commentary
  - **Wisdom only**
  - Example: "Two minutes in the box teaches you that sometimes you need to sit with your mistakes before you can get back in the game."

### Legacy Field

- **`content_text`** (TEXT)
  - Still REQUIRED for: motivational, greetings, stats
  - OPTIONAL for wisdom (legacy support)
  - For new wisdom content, use `musings` + `from_the_box` instead

## Migration

### SQL Files Created

1. **`sql/12-add-wisdom-content-structure.sql`**
   - Adds the three new columns
   - Includes documentation comments

2. **`sql/13-migrate-wisdom-content.sql`**
   - Parses existing wisdom `content_text`
   - Splits into `musings` and `from_the_box`
   - Handles content with pattern: `[musing] from the box: [commentary]`

### Running Migration

```sql
-- 1. Add columns
\i sql/12-add-wisdom-content-structure.sql

-- 2. Migrate existing data
\i sql/13-migrate-wisdom-content.sql
```

## Gemini Prompt Updates

### Required Format

When generating wisdom content, Gemini should return JSON with this structure:

```json
{
  "items": [
    {
      "content_title": "Patience Under Pressure",
      "musings": "The best defense isn't just keeping the puck out of your zone, it's building a better zone for everyone.",
      "from_the_box": "Two minutes for holding teaches you that sometimes you need to let go to move forward.",
      "theme": "Leadership & Staff",
      "content_type": "wisdom"
    }
  ]
}
```

### Example Prompt Addition

```
For each wisdom item, provide:
1. content_title: A 3-4 word title capturing the essence
2. musings: A philosophical quote or thought (1-2 sentences)
3. from_the_box: Commentary from the penalty box perspective (1-2 sentences)
4. theme: The relevant theme from the list
```

## UI Display

### ContentCard Component

Wisdom content now displays as:

```
[Title] (optional, shown in indigo)
"[Musings]" (italic, emphasized)
From the box: [Commentary] (smaller text)
```

### Fallback Behavior

- If `musings` and `from_the_box` exist → use them
- If not → parse `content_text` using pattern matching
- Maintains backward compatibility with legacy content

## Code Updates

### TypeScript Interfaces

```typescript
export interface Content {
  // ... other fields
  content_title?: string | null;
  musings?: string | null;
  from_the_box?: string | null;
  // ...
}
```

### API Routes

- **GET `/api/uni-content`** - Returns all fields
- **PATCH `/api/uni-content/[id]`** - Can update any field
- **POST generation routes** - Accept new structure

### Files Modified

1. `lib/content-types.ts` - Updated interfaces
2. `components/content-card.tsx` - Enhanced display logic
3. `app/api/gemini/generate-penalty-box-philosopher/route.ts` - Updated formatting
4. `app/api/uni-content/route.ts` - Filters out archived/deleted

## Testing Checklist

- [ ] Run SQL migrations
- [ ] Verify existing wisdom content displays correctly
- [ ] Generate new wisdom content with updated prompt
- [ ] Check ContentCard displays title, musings, and from_the_box
- [ ] Verify other content types (motivational, stats, greetings) still work
- [ ] Test archive/delete functionality

## Future Considerations

### Other Content Types

Consider adding `content_title` prompts for:

- Motivational content
- Stats content
- Greetings content

These types don't need `musings`/`from_the_box`, but would benefit from titles.

### Data Cleanup

After migration, consider:

1. Reviewing parsed wisdom for accuracy
2. Setting `content_text` to NULL for wisdom items with proper `musings`/`from_the_box`
3. Adding database constraints if needed
